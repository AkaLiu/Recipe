---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import RecipeCard from '../components/RecipeCard.astro';

const allRecipes = await getCollection('recipes');

// Group recipes by category
const recipesByCategory = allRecipes.reduce((acc, recipe) => {
  const category = recipe.data.category;
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push({
    ...recipe.data,
    slug: recipe.slug,
  });
  return acc;
}, {} as Record<string, typeof allRecipes[0]['data'][]>);

const categories = [
  { name: 'å·', label: 'å·èœ', emoji: 'ğŸŒ¶ï¸' },
  { name: 'ç²¤é—½', label: 'ç²¤é—½', emoji: 'ğŸ¥˜' },
  { name: 'æ·®æ‰¬', label: 'æ·®æ‰¬', emoji: 'ğŸ²' },
  { name: 'äº‘è´µ', label: 'äº‘è´µ', emoji: 'ğŸ¦' },
  { name: 'æ„æ³•', label: 'æ„æ³•', emoji: 'ğŸ' },
  { name: 'å—æ´‹', label: 'å—æ´‹', emoji: 'ğŸ‹' },
  { name: 'é²', label: 'é²èœ', emoji: 'ğŸ¥¬' },
  { name: 'å¾½æ¹˜', label: 'å¾½æ¹˜', emoji: 'ğŸŸ' },
  { name: 'Silk-Road', label: 'ä¸è·¯', emoji: 'ğŸ›¤ï¸' },
  { name: 'Desserts', label: 'ç”œç‚¹', emoji: 'ğŸ°' },
  { name: 'Drinks', label: 'é¥®å“', emoji: 'ğŸ§‹' },
];

const totalRecipes = allRecipes.length;
---

<BaseLayout title="èœè°±æ”¶è— | Recipe Collection">
  <!-- Hero Section -->
  <section class="relative bg-gradient-to-br from-terracotta-600 to-terracotta-800 text-white py-20 md:py-32">
    <div class="absolute inset-0 bg-[url('/images/backgrounds/pattern.svg')] opacity-10"></div>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative text-center">
      <h1 class="text-4xl md:text-6xl font-serif font-bold mb-4">
        èœè°±æ”¶è—
      </h1>
      <p class="text-xl md:text-2xl text-white/80 mb-8">
        A personal collection of recipes
      </p>
      <p class="text-white/60 mb-8">
        {totalRecipes} recipes from various cuisines
      </p>
      <div class="flex flex-wrap justify-center gap-4">
        <a
          href="#categories"
          class="inline-flex items-center gap-2 px-6 py-3 bg-white text-terracotta-700 rounded-lg font-medium hover:bg-cream-50 transition-colors"
        >
          æµè§ˆèœç³»
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </a>
        <a
          href="/Recipe/book"
          class="inline-flex items-center gap-2 px-6 py-3 border-2 border-white text-white rounded-lg font-medium hover:bg-white/10 transition-colors"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          å¯¼å‡º PDF å…¨ä¹¦
        </a>
      </div>
    </div>
  </section>

  <!-- Categories Section -->
  <section id="categories" class="py-16 md:py-24">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl font-serif font-bold text-center text-gray-900 mb-12">
        èœç³»åˆ†ç±»
      </h2>

      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {categories.map((cat) => (
          <a
            href={`/Recipe/${cat.name}`}
            class="group flex flex-col items-center p-6 bg-white rounded-xl shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-1"
          >
            <span class="text-4xl mb-3">{cat.emoji}</span>
            <span class="font-semibold text-gray-900 group-hover:text-terracotta-600 transition-colors">
              {cat.label}
            </span>
            <span class="text-sm text-gray-500 mt-1">
              {recipesByCategory[cat.name]?.length || 0} é“èœ
            </span>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Recent Recipes Section -->
  <section class="py-16 md:py-24 bg-cream-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center mb-12">
        <h2 class="text-3xl font-serif font-bold text-gray-900">
          å…¨éƒ¨èœè°±
        </h2>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        {allRecipes.slice(0, 12).map((recipe) => (
          <RecipeCard
            title={recipe.data.title}
            titleEn={recipe.data.titleEn}
            category={recipe.data.category}
            prepTime={recipe.data.prepTime}
            cookTime={recipe.data.cookTime}
            servings={recipe.data.servings}
            coverImage={recipe.data.coverImage}
            id={recipe.id}
          />
        ))}
      </div>

      {allRecipes.length > 12 && (
        <div class="text-center mt-12">
          <a
            href="/Recipe/å·"
            class="px-6 py-3 border-2 border-terracotta-600 text-terracotta-600 rounded-lg hover:bg-terracotta-50 transition-colors font-medium inline-flex items-center gap-2"
          >
            æŸ¥çœ‹æ›´å¤šèœè°±
          </a>
        </div>
      )}
    </div>
  </section>
</BaseLayout>
